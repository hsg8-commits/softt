# 🧪 دليل اختبار المشروع بعد الإصلاح

## 🚀 البداية السريعة

### 1. تثبيت المتطلبات

```bash
# تأكد من وجود Node.js (الإصدار 18 أو أحدث)
node --version

# تثبيت المكتبات
npm install
```

### 2. تشغيل المشروع

يحتاج المشروع إلى تشغيل جزئين في نفس الوقت:

#### Terminal 1: خادم Socket.IO
```bash
npm run server
```
يجب أن ترى:
```
Socket server is running on port 3001
```

#### Terminal 2: تطبيق Next.js
```bash
npm run dev
```
يجب أن ترى:
```
▲ Next.js 15.4.5
- Local:        http://localhost:3000
```

### 3. فتح التطبيق

افتح المتصفح على: **http://localhost:3000**

---

## ✅ اختبار الميزات

### 📝 اختبار الرسائل النصية

1. **سجل دخول** أو **أنشئ حساب جديد**
2. **افتح محادثة** أو **أنشئ محادثة جديدة**
3. **اكتب رسالة** في حقل الإدخال
4. **اضغط إرسال** ✈️

#### ✅ النتيجة المتوقعة:
- ✅ الرسالة تظهر فوراً
- ✅ حالة الرسالة: ✓ (تم الإرسال)
- ✅ الوقت يظهر بشكل صحيح
- ✅ المستقبل يرى الرسالة فوراً

---

### 📷 اختبار الصور

1. **اضغط على زر المرفقات** 📎 (جانب حقل الإدخال)
2. **اختر صورة** من جهازك (JPG, PNG, GIF, WebP)
3. **انتظر المعاينة** - ستظهر الصورة في شاشة كاملة
4. **(اختياري)** أضف تعليق في حقل النص
5. **اضغط زر الإرسال** ✈️

#### ✅ النتيجة المتوقعة:
- ✅ شريط التقدم يظهر أثناء الرفع (0% → 100%)
- ✅ الصورة تُرفع إلى Cloudinary
- ✅ الصورة تظهر في المحادثة
- ✅ يمكن الضغط عليها لفتحها بالحجم الكامل

---

### 📄 اختبار الملفات

1. **اضغط على زر المرفقات** 📎
2. **اختر ملف** (PDF, DOC, DOCX, ZIP, RAR, إلخ)
3. **انتظر المعاينة** - سترى أيقونة الملف ومعلوماته
4. **(اختياري)** أضف تعليق
5. **اضغط إرسال** ✈️

#### ✅ النتيجة المتوقعة:
- ✅ شريط التقدم يعمل
- ✅ الملف يُرفع بنجاح
- ✅ الملف يظهر مع أيقونة مناسبة
- ✅ يمكن تحميل الملف بالضغط عليه

---

### 🎵 اختبار الملفات الصوتية

1. **اضغط على زر المرفقات** 📎
2. **اختر ملف صوتي** (MP3, WAV, OGG, M4A)
3. **انتظر المعاينة** - سترى مشغل صوتي
4. **(اختياري)** جرب تشغيل الصوت في المعاينة
5. **اضغط إرسال** ✈️

#### ✅ النتيجة المتوقعة:
- ✅ الملف يُرفع بنجاح
- ✅ مشغل صوتي جميل يظهر في المحادثة
- ✅ يمكن تشغيل الصوت مباشرة
- ✅ يظهر اسم الملف وحجمه

---

### 🎤 اختبار التسجيلات الصوتية

1. **اضغط مع الاستمرار** على زر الميكروفون 🎤
2. **تحدث** لتسجيل الرسالة
3. **ارفع إصبعك** عند الانتهاء

#### ✅ النتيجة المتوقعة:
- ✅ التسجيل يبدأ فوراً
- ✅ المدة تظهر أثناء التسجيل
- ✅ الرسالة ترسل تلقائياً عند الإفلات
- ✅ المستقبل يمكنه تشغيل الرسالة

---

## 🔄 اختبار الميزات المتقدمة

### الرد على رسالة (Reply)
1. **اضغط مطولاً** على رسالة
2. **اختر "رد"** من القائمة
3. **اكتب ردك**
4. **أرسل**

✅ يجب أن يظهر الرد مرتبطاً بالرسالة الأصلية

### تعديل رسالة (Edit)
1. **اضغط مطولاً** على رسالتك
2. **اختر "تعديل"**
3. **عدّل النص**
4. **اضغط ✓**

✅ الرسالة تتحدث ويظهر "مُعدّل" بجانبها

### تثبيت رسالة (Pin)
1. **اضغط مطولاً** على رسالة
2. **اختر "تثبيت"**

✅ الرسالة تُثبت في أعلى المحادثة

---

## 🌐 اختبار في بيئة الإنتاج

إذا كان لديك المشروع منشور على Vercel و Render:

### 1. تحديث الكود
```bash
# في فرع الإصلاح
git push origin fix/message-sending-support

# أو بعد الدمج في main
git push origin main
```

### 2. Render.com (خادم Socket.IO)
- سيُبنى تلقائياً بعد Push
- انتظر ~2-3 دقائق
- تحقق من Logs أن الخادم يعمل

### 3. Vercel.com (تطبيق Next.js)
- سيُبنى تلقائياً بعد Push
- انتظر ~3-5 دقائق
- افتح رابط التطبيق

### 4. اختبر جميع الميزات
كرر نفس الاختبارات السابقة على النسخة المنشورة

---

## ⚠️ مشاكل شائعة وحلولها

### المشكلة 1: "Failed to fetch" عند الإرسال
**السبب:** خادم Socket.IO غير متصل

**الحل:**
```bash
# تأكد من أن خادم Socket.IO يعمل
npm run server

# تحقق من URL في .env
echo $NEXT_PUBLIC_SOCKET_SERVER_URL
```

### المشكلة 2: الصور لا تُرفع
**السبب:** إعدادات Cloudinary خاطئة

**الحل:**
```bash
# تحقق من .env
cat .env | grep CLOUDINARY

# يجب أن ترى:
# NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME=...
# NEXT_PUBLIC_CLOUDINARY_API_KEY=...
# NEXT_PUBLIC_CLOUDINARY_API_SECRET=...
```

### المشكلة 3: "uuid is not defined"
**السبب:** المكتبة غير مثبتة

**الحل:**
```bash
npm install uuid
```

### المشكلة 4: الرسائل لا تظهر
**السبب:** قاعدة البيانات غير متصلة

**الحل:**
```bash
# تحقق من MongoDB URI
cat .env | grep MONGODB_URI

# تحقق من الاتصال في logs الخادم
```

---

## 📊 قائمة فحص شاملة

### قبل الاختبار
- [ ] npm install تم بنجاح
- [ ] ملف .env موجود ومكتمل
- [ ] خادم Socket.IO يعمل (port 3001)
- [ ] تطبيق Next.js يعمل (port 3000)

### اختبار الوظائف الأساسية
- [ ] تسجيل الدخول يعمل
- [ ] إنشاء محادثة جديدة
- [ ] إرسال رسالة نصية
- [ ] استقبال رسالة

### اختبار الملفات
- [ ] رفع صورة
- [ ] رفع ملف PDF
- [ ] رفع ملف صوتي
- [ ] رفع ملف ZIP
- [ ] تسجيل رسالة صوتية

### اختبار الميزات المتقدمة
- [ ] الرد على رسالة
- [ ] تعديل رسالة
- [ ] حذف رسالة
- [ ] تثبيت رسالة
- [ ] البحث في الرسائل

### اختبار الأداء
- [ ] الرسائل تظهر فوراً
- [ ] الصور تُرفع بسرعة معقولة
- [ ] المحادثة تعمل بسلاسة
- [ ] لا توجد تأخيرات ملحوظة

---

## 🎯 معايير النجاح

الإصلاح يعتبر ناجحاً إذا:

1. ✅ **جميع أنواع الرسائل تُرسل بنجاح**
   - نص ✓
   - صور ✓
   - ملفات ✓
   - صوت ✓

2. ✅ **لا توجد أخطاء في Console**
   - لا أخطاء في المتصفح
   - لا أخطاء في خادم Socket.IO
   - لا أخطاء في تطبيق Next.js

3. ✅ **التجربة سلسة**
   - الرسائل تظهر فوراً
   - الواجهة تستجيب بسرعة
   - لا تجميد أو تأخير

4. ✅ **الميزات المتقدمة تعمل**
   - الرد والتعديل
   - التثبيت والحذف
   - المعاينة والتحميل

---

## 📝 تسجيل النتائج

استخدم هذا النموذج لتسجيل نتائج الاختبار:

```markdown
## نتائج الاختبار - [التاريخ]

### البيئة
- Node.js: v__.__.__
- نظام التشغيل: _______
- المتصفح: _______

### الوظائف الأساسية
- [ ] ✅ / ❌ الرسائل النصية
- [ ] ✅ / ❌ الصور
- [ ] ✅ / ❌ الملفات
- [ ] ✅ / ❌ الصوت
- [ ] ✅ / ❌ التسجيلات الصوتية

### الملاحظات
_______________________
_______________________

### الأخطاء (إن وجدت)
_______________________
_______________________
```

---

## 🆘 طلب المساعدة

إذا واجهت أي مشاكل أثناء الاختبار:

1. **راجع الـ Logs**
   - Console في المتصفح (F12)
   - Terminal خادم Socket.IO
   - Terminal تطبيق Next.js

2. **تحقق من الإعدادات**
   - ملف .env
   - package.json
   - متغيرات البيئة

3. **أعد تشغيل الخوادم**
   ```bash
   # أوقف الخوادم (Ctrl+C)
   # ثم أعد التشغيل
   npm run server  # Terminal 1
   npm run dev     # Terminal 2
   ```

4. **افحص Pull Request**
   - https://github.com/AhmedAbuKhair/web-main/pull/1
   - راجع التعليقات والتغييرات

---

## 🎉 النجاح!

إذا اجتزت جميع الاختبارات، تهانينا! 🎊

المشروع الآن يعمل بشكل كامل وجاهز للاستخدام!

---

**دليل الاختبار - تم الإنشاء في:** 29 أكتوبر 2024
